
# 회원 관리 예제: 웹 MVC 개발

## 회원 웹 기능 - 홈 화면 추가

### 1. 홈 컨트롤러

- 사용자의 요청을 처리하고 적절한 View를 반환합니다.

```java
@Controller
public class HomeController {
    @GetMapping("/")
    public String home() {
        return "home";
    }
}
```

### 2. 홈 HTML

- Thymeleaf를 사용하여 동적으로 렌더링 가능한 HTML 작성.

```html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <div class="container">
        <h1>Hello Spring</h1>
        <p>회원 기능</p>
        <p>
            <a href="/members/new">회원 가입</a>
            <a href="/members">회원 목록</a>
        </p>
    </div>
</body>
</html>
```

---

## 회원 웹 기능 - 등록

### 1. 회원 등록 폼 컨트롤러

- 사용자 입력 화면(View)을 반환.

```java
@Controller
public class MemberController {
    private final MemberService memberService;

    @Autowired
    public MemberController(MemberService memberService) {
        this.memberService = memberService;
    }

    @GetMapping(value = "/members/new")
    public String createForm() {
        return "members/createMemberForm";
    }
}
```

### 2. 회원 등록 폼 HTML

```html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <div class="container">
        <form action="/members/new" method="post">
            <div class="form-group">
                <label for="name">이름</label>
                <input type="text" id="name" name="name" placeholder="이름을 입력하세요">
            </div>
            <button type="submit">등록</button>
        </form>
    </div>
</body>
</html>
```

### 3. 폼 객체와 회원 등록 기능

- 폼 데이터를 담을 객체를 사용하여 컨트롤러에서 데이터를 처리.

```java
public class MemberForm {
    private String name;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}

@PostMapping(value = "/members/new")
public String create(MemberForm form) {
    Member member = new Member();
    member.setName(form.getName());
    memberService.join(member);
    return "redirect:/";
}
```

---

## 회원 웹 기능 - 조회

### 1. 회원 조회 컨트롤러

- 저장된 모든 회원 정보를 조회하여 View로 전달.

```java
@GetMapping(value = "/members")
public String list(Model model) {
    List<Member> members = memberService.findMembers();
    model.addAttribute("members", members);
    return "members/memberList";
}
```

### 2. 회원 목록 HTML

```html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <div class="container">
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>이름</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="member : ${members}">
                    <td th:text="${member.id}"></td>
                    <td th:text="${member.name}"></td>
                </tr>
            </tbody>
        </table>
    </div>
</body>
</html>
```

---

# 스프링 DB 접근 기술

## H2 데이터베이스 설정

### 1. H2 데이터베이스란?

- 경량의 메모리 기반 데이터베이스로, 개발 및 테스트 용도로 사용.
- 테이블 생성 SQL:

```sql
drop table if exists member CASCADE;
create table member (
    id bigint generated by default as identity,
    name varchar(255),
    primary key (id)
);
```

---

## 순수 JDBC

### 1. 특징

- JDBC API를 사용하여 데이터베이스와 직접 통신.
- 코드 양이 많고 유지보수가 어려움.

### 2. JDBC 회원 리포지토리 구현

```java
public class JdbcMemberRepository implements MemberRepository {
    private final DataSource dataSource;

    public JdbcMemberRepository(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    @Override
    public Member save(Member member) {
        String sql = "insert into member(name) values(?)";
        try (Connection conn = getConnection();
             PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)) {
            pstmt.setString(1, member.getName());
            pstmt.executeUpdate();
            try (ResultSet rs = pstmt.getGeneratedKeys()) {
                if (rs.next()) {
                    member.setId(rs.getLong(1));
                }
            }
            return member;
        } catch (Exception e) {
            throw new IllegalStateException(e);
        }
    }

    private Connection getConnection() {
        return DataSourceUtils.getConnection(dataSource);
    }
}
```

---

## 스프링 JdbcTemplate

### 1. 특징

- JDBC API의 반복 코드를 대부분 제거.
- SQL은 직접 작성해야 함.

### 2. JdbcTemplate 회원 리포지토리 구현

```java
public class JdbcTemplateMemberRepository implements MemberRepository {
    private final JdbcTemplate jdbcTemplate;

    public JdbcTemplateMemberRepository(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }

    @Override
    public Member save(Member member) {
        SimpleJdbcInsert jdbcInsert = new SimpleJdbcInsert(jdbcTemplate)
                .withTableName("member")
                .usingGeneratedKeyColumns("id");
        Map<String, Object> parameters = new HashMap<>();
        parameters.put("name", member.getName());
        Number key = jdbcInsert.executeAndReturnKey(new MapSqlParameterSource(parameters));
        member.setId(key.longValue());
        return member;
    }
}

```

---

## JPA

### 1. JPA란?

- ORM 기술 표준으로, 객체와 데이터베이스를 매핑.
- SQL 중심 개발에서 객체 중심 개발로 전환.

### 2. JPA 엔티티 매핑

```java
@Entity
public class Member {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
}
```

### 3. JPA 회원 리포지토리 구현

```java
public class JpaMemberRepository implements MemberRepository {
    private final EntityManager em;

    public JpaMemberRepository(EntityManager em) {
        this.em = em;
    }

    @Override
    public Member save(Member member) {
        em.persist(member);
        return member;
    }

    @Override
    public List<Member> findAll() {
        return em.createQuery("select m from Member m", Member.class)
                 .getResultList();
    }
}
```

### 4. 트랜잭션 설정

- 모든 데이터 변경은 트랜잭션 안에서 이루어져야 함.

```java
@Service
@Transactional
public class MemberService {
    private final MemberRepository memberRepository;

    public MemberService(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }
}
```

---
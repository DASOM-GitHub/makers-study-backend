# 3주차
# - 섹션 6. 회원  관리 예쩨 - 웹 MVC 개발
# - 섹션 7. 스프링 DB 접근 기술


#### 회원 웹 기능 - 홈 화면 추가

홈 컨트롤러 추가<br>
@GetMapping의 호출 다음 home.html(뷰)을 찾아 실행

```
@Controller
public class HomeController {

@GetMapping("/")
public String home() {
return "home";
}

}

```


#### 회원 웹 기능 - 등록

회원 등록 폼 컨트롤러

```
@Controller
public class MemberController {
    private final MemberService memberService;

    @Autowired
    public MemberController(MemberService memberService) {
        this.memberService = memberService;
    }

    @GetMapping(value = "/members/new")
    public String createForm() {
        return "members/createMemberForm";
    }

}   
```

회원 등록 컨트롤러
Getter Setter 사용

```
package hello.hellospring.controller;

public class MemberForm {

private String name;

public String getName() {
return name;
}

public void setName(String name) {
this.name = name;
}

}
```
회원 컨트롤러에서 회원을 실제 등록하는 기능

```
@PostMapping(value = "/members/new")
public String create(MemberForm form) {
    Member member = new Member(); // 만든 코드 import하기!
    member.setName(form.getName());

    memberService.join(member);
    return "redirect:/";

}

```

POST Mapping: 데이터를 폼에 넣어 전달. <br>
GET Mapping: 데이터를 조회할 떄 주로 씀 <br>


### 회원 웹 기능 - 조회

회원 컨트롤러에서 조회하는 기능

```
@GetMapping(value = "/members")
  public String list(Model model) {

    List<Member> members = memberService.findMembers();
    model.addAttribute("members", members);
    return "members/memberList";

}
```

## 섹션 7.

### H2 데이터베이스 설치

H2 데이터베이스: 교육용으로 유용, 용량 낮음, 웹 화면 제공 가능. <br>
테이블 생성 (H2데이터베이스에 접근해서 member 테이블 생성)

```
drop table if exists member CASCADE;
create table member (

    id bigint generated by default as identity,
    name varchar(255),
    primary key (id)
);

```

### 순수 JDBC

build.gradle 파일에 jdbc,h2 데이터베이스 관련 라이브러리 추가

```
implementation 'org.springframework.boot:spring-boot-starter-jdbc'
runtimeOnly 'com.h2database:h2'
```

스프링 부트 데이터베이스 연결 설정 추가

```
spring.datasource.url=jdbc:h2:tcp://localhost/~/test
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
```

JDBC 리포지토리 구현 -> 참고만 하기, 15`20년 전 개발 방법


스프링 컨테이너
- 개방-폐쇄 원칙(OCP, Open-Closed Principle)
: 확장에는 열려있고 수정/변경에는 닫혀있음<br>
- 스프링의 DI (Dependencies Injection)을 사용하면 기존 코드를 전혀 손대지 않고, 설정만으로 구현클래스를 변경할 수 있음<br>

### 스프링 통합 테스트

스프링 컨테이너와 디비를 연결한 통합 테스트 진행하기!


@SpringBootTest: 스프링 컨테이너와 테스트를 함꼐 진행.<br>
@Transactional: 테스트 케이스에 이 에노테이션이 있다면 테스트 시작 전에 트랜잭션 시작, 테스트 완료 후 롤백함.<br>
=> 디비에 데이터가 남지 않아 다음 테스트에 영향을 주지 X.<br>

### 스프링 JDBC Template
순수 JDBC와 동일한 환경설정을 하면 됨.<br>
스프링 JdbcTemplate과 MyBatis 같은 라이브러리는 JDBC API에서 본 반복 코드를 대부분 제거해준다. 하지만 SQL은 직접 작성해야 한다.<br>


단위 테스트: 개별 동작을 독립적으로 쪼개어 테스트하는 것<br>
통합 테스트: 컨테이너와 DB와 같은 것들을 실제로 결합해 하는 테스트 -> 속도 느리다는 단점 있음. <br>
(보통 단위 테스트가 더 좋은 테스트일 확률이 높다.)


### JPA
JPA는 기존의 반복 코드는 물론 기본적인 SQL까지 만들어 실행해 준다.<br>
SQL과 데이터 중심의 설계에서 객체 중심의 설계로 전환이 가능하다.<br>
개발 생산성을 크게 높일 수 있다.

JPA 엔티티 매핑

```
@Entity
public class Member {
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY) //자동 id생성
    private long id;
    private String name;
  
  // +Getter Setter
}
```
JPA 사용 시의 주의사항 => 항상 트랜잭션이 있어야 함.<br>
__@Transactional__ 사용


### 스프링 데이터 JPA
스프링 부트 + JPA + 스프링 데이터 JPA 사용 시 리포지토리 구현 클래스 없이 인터페이스만읋 개발 완료가 가능. <br>
findByNAme(), findByEmail() 처럼 이름만으로도 조회 기능 제공 가능.








